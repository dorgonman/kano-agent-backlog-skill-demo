{
  "name": "before_merge_20260118T232309",
  "topic": "embedding-preprocessing-and-vector-backend-research",
  "created_at": "2026-01-18T23:23:09.415958Z",
  "created_by": "copilot",
  "description": "Automatic snapshot before merge operation",
  "manifest": {
    "topic": "embedding-preprocessing-and-vector-backend-research",
    "agent": "copilot",
    "seed_items": [
      "019bc21c-6e9c-765a-877f-994bacdf5002",
      "019bc21c-ec25-70e2-84ec-d0042844af4d",
      "019bac4a-6857-7432-b43f-3082737ca786",
      "019bcbef-dc2a-778e-8c87-d5619170230c",
      "019bcbf0-58b4-7308-81e0-4aaed24cd43b",
      "019bcbf4-71e9-7150-9498-889e8a1af8e9",
      "019bcbf4-aed0-77ec-8d79-15407c5db49a",
      "019bc754-30c3-70fa-8740-c643948c9a9d",
      "019bc754-4618-71c1-9ff9-db63c0d47561",
      "019b8f52-9f4a-754d-8d3a-81c5e41c131a",
      "019bac4a-683c-76c3-adc9-bf67e569e226",
      "019b8f52-9fc8-7c94-aa2d-806cacdd9086"
    ],
    "pinned_docs": [
      "_kano/backlog/topics/embedding-preprocessing-and-vector-backend-research/synthesis/tokenizers-and-embeddings-key-takeaways.md",
      "_kano/backlog/products/kano-agent-backlog-skill/decisions/ADR-0009_local-first-embedding-search-architecture.md"
    ],
    "snippet_refs": [],
    "related_topics": [],
    "status": "closed",
    "closed_at": "2026-01-18T19:36:46.444820Z",
    "created_at": "2026-01-15T14:42:05.217983Z",
    "updated_at": "2026-01-18T19:36:46.444820Z",
    "has_spec": false
  },
  "brief_content": "# Topic Brief: embedding-preprocessing-and-vector-backend-research\n\nGenerated: 2026-01-18T19:36:40.029597Z\n\n## Facts\n\n<!-- Verified facts with citations to materials/items/docs -->\n- [ ] {fact} — [source](ref)\n\n## Unknowns / Risks\n\n- [ ] {unknown or risk}\n\n## Proposed Actions\n\n- [ ] {action} → {workitem ref or \"new ticket needed\"}\n\n## Decision Candidates\n\n- [ ] {decision} → {ADR ref or \"draft needed\"}\n\n## Related Topics\n\n- (none)\n\n## Materials Index (Deterministic)\n\n### Items\n- KABSD-EPIC-0003: Milestone 0.0.2 (Indexing + Resolver) (Epic, InProgress) - `_kano/backlog/products/kano-agent-backlog-skill/items/epic/0000/KABSD-EPIC-0003_milestone-0-0-2-indexing-resolver.md` <!-- uid: 019bac4a-6857-7432-b43f-3082737ca786 -->\n- KABSD-FTR-0042: Embedding providers, tokenizers, and benchmark harness (Feature, InProgress) - `_kano/backlog/products/kano-agent-backlog-skill/items/feature/0000/KABSD-FTR-0042_embedding-providers-tokenizers-and-benchmark-harness.md` <!-- uid: 019bcbef-dc2a-778e-8c87-d5619170230c -->\n- KABSD-TSK-0056: Define embedding chunking + metadata schema for backlog items (Task, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/task/0000/KABSD-TSK-0056_define-embedding-chunking-metadata-schema-for-backlog-items.md` <!-- uid: 019b8f52-9fc8-7c94-aa2d-806cacdd9086 -->\n- KABSD-TSK-0124: 'Research: Comparative Performance and Deployment of SQLite-Vec vs FAISS vs (Task, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/task/0100/KABSD-TSK-0124_research-embedding-search-options-performance-and-deployment.md` <!-- uid: 019bac4a-683c-76c3-adc9-bf67e569e226 -->\n- KABSD-TSK-0207: Research and spec chunking, token budget fitting, and trimming for embeddings (Task, Proposed) - `_kano/backlog/products/kano-agent-backlog-skill/items/task/0200/KABSD-TSK-0207_research-and-spec-chunking-token-budget-fitting-and-trimming-for-embeddings.md` <!-- uid: 019bc21c-6e9c-765a-877f-994bacdf5002 -->\n- KABSD-TSK-0208: Reframe vector index backend research as pluggable backend (KABSD-TSK-0124) (Task, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/task/0200/KABSD-TSK-0208_reframe-vector-index-backend-research-as-pluggable-backend-kabsd-tsk-0124.md` <!-- uid: 019bc21c-ec25-70e2-84ec-d0042844af4d -->\n- KABSD-USR-0015: Generate embeddings for backlog items (derivative index) (UserStory, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0015_generate-embeddings-for-backlog-items-derivative-index.md` <!-- uid: 019b8f52-9f4a-754d-8d3a-81c5e41c131a -->\n- KABSD-USR-0029: Chunking and token-budget embedding pipeline MVP (UserStory, InProgress) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0029_chunking-and-token-budget-embedding-pipeline-mvp.md` <!-- uid: 019bc754-30c3-70fa-8740-c643948c9a9d -->\n- KABSD-USR-0030: Pluggable vector backend MVP for embeddings (UserStory, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0030_pluggable-vector-backend-mvp-for-embeddings.md` <!-- uid: 019bc754-4618-71c1-9ff9-db63c0d47561 -->\n- KABSD-USR-0031: Embedding adapter interface with token-counting telemetry (UserStory, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0031_embedding-adapter-interface-with-token-counting-telemetry.md` <!-- uid: 019bcbf0-58b4-7308-81e0-4aaed24cd43b -->\n- KABSD-USR-0034: Benchmark harness for chunking and embedding options (multilingual, window (UserStory, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0034_benchmark-harness-for-chunking-and-embedding-options-multilingual-window-limits.md` <!-- uid: 019bcbf4-71e9-7150-9498-889e8a1af8e9 -->\n- KABSD-USR-0035: Decide cross-lingual retrieval and index strategy via ADRs (UserStory, Done) - `_kano/backlog/products/kano-agent-backlog-skill/items/userstory/0000/KABSD-USR-0035_decide-cross-lingual-retrieval-and-index-strategy-via-adrs.md` <!-- uid: 019bcbf4-aed0-77ec-8d79-15407c5db49a -->\n\n### Pinned Docs\n- _kano/backlog/products/kano-agent-backlog-skill/decisions/ADR-0009_local-first-embedding-search-architecture.md\n- _kano/backlog/topics/embedding-preprocessing-and-vector-backend-research/synthesis/tokenizers-and-embeddings-key-takeaways.md\n\n### Snippet Refs\n- (none)\n",
  "notes_content": "# Topic Notes: embedding-preprocessing-and-vector-backend-research\n\n## Overview\n\nThis topic collects research and design notes for a local-first embedding pipeline:\n- deterministic chunking + token-budget fitting for embeddings\n- embedding provider + tokenizer adapter interfaces with telemetry\n- vector backend selection (portable, rebuildable, no server runtime)\n\nThis topic is meant to support human review and unblock decisions before and during\nimplementation.\n\nKey synthesis:\n- `_kano/backlog/topics/embedding-preprocessing-and-vector-backend-research/synthesis/tokenizers-and-embeddings-key-takeaways.md`\n\n## Current Status (What Exists)\n\nStrategic direction (architecture):\n- ADR-0009: `_kano/backlog/products/kano-agent-backlog-skill/decisions/ADR-0009_local-first-embedding-search-architecture.md`\n  - Local-first, file-first canonical store (Markdown), derived store (SQLite)\n  - Semantic search via derived ANN sidecar; keyword search via SQLite FTS5\n\nEvidence for backend feasibility (Windows-focused):\n- KABSD-TSK-0124 artifact:\n  `_kano/backlog/products/kano-agent-backlog-skill/artifacts/KABSD-TSK-0124/embedding_search_library_evaluation.md`\n  - HNSWlib: build fails on Windows without a compiler toolchain\n  - FAISS-CPU: pre-built wheels work on Windows\n  - sqlite-vec: wheels exist but maturity risk (v0.1.6 in the report)\n\nExisting specs / contracts:\n- Chunking metadata schema draft (JSONL) from KABSD-TSK-0056:\n  `_kano/backlog/products/kano-agent-backlog-skill/artifacts/KABSD-TSK-0056/embedding_chunking_metadata.md`\n- Chunking + token budget fitting contract draft from KABSD-TSK-0207:\n  `_kano/backlog/products/kano-agent-backlog-skill/items/task/0200/KABSD-TSK-0207_research-and-spec-chunking-token-budget-fitting-and-trimming-for-embeddings.md`\n- Vector backend adapter contract from KABSD-TSK-0208:\n  `_kano/backlog/products/kano-agent-backlog-skill/items/task/0200/KABSD-TSK-0208_reframe-vector-index-backend-research-as-pluggable-backend-kabsd-tsk-0124.md`\n\nPlanned work items (seed set in manifest):\n- KABSD-EPIC-0003: Milestone 0.0.2 end-to-end chain (chunking -> embeddings -> vector backend)\n- KABSD-USR-0029: Chunking + token-budget MVP (InProgress)\n- KABSD-USR-0030: Pluggable vector backend MVP (Proposed)\n- KABSD-FTR-0042 + USR-0031/0034/0035: embedder/tokenizer adapters, telemetry, and benchmarks (Proposed)\n\n## Key Decisions (Pending / To Be Made)\n\n1) Cross-lingual retrieval requirement: YES\n- Implication: default embedding policy must be multilingual-capable and evaluation must include cross-lingual cases.\n- ADR: ADR-0035\n\n2) Index strategy baseline: per-model indexes by default\n- Rationale: vectors from different embedding models are not generally comparable; mixing them in one ANN index is unsafe.\n- We will route by an explicit `embedding_space_id` (model+revision+dims+preprocessing).\n- Future “sharing” is allowed only via explicit allowlisted aliasing (no automatic inference).\n- ADR: ADR-0036\n\n3) Default local-first embedder family (quality vs footprint)\n- Candidate families mentioned in synthesis: MiniLM-class vs multilingual GTE/BGE-class.\n- Work item: KABSD-FTR-0042 / KABSD-USR-0034\n\n4) Default vector backend library (portable, low-friction)\n- Based on current evidence, FAISS-CPU appears viable on Windows; HNSWlib is risky.\n- sqlite-vec is attractive for simplicity but maturity needs re-checking.\n- Work items: KABSD-TSK-0124 (evidence), KABSD-USR-0030 (implementation)\n\n## Decisions Already Made (Recorded)\n\n- Local-first strategic architecture: use a derived index and keep Markdown as the canonical store.\n  - Source: ADR-0009\n\n## Open Questions / Risks\n\n- Token inflation for CJK can shrink effective context windows and skew chunking/benchmarks.\n- Token counting accuracy varies by provider/tokenizer; telemetry must distinguish exact vs heuristic.\n- Deterministic chunk IDs must be versioned (to control rebuild triggers) and stable across runs.\n- Optional dependencies (tiktoken, transformers, sentence-transformers, faiss) must remain optional\n  or carefully gated to avoid breaking local-first setup.\n\n## Recommended Next Actions (Concrete)\n\nShort-term (to support human review and de-risk implementation):\n- Add snippet references for the current chunking implementation (if any) and vector backend adapter\n  implementation, so the topic has auditable code anchors.\n- Complete and review ADR-0035 and ADR-0036 (promote from Proposed once reviewed).\n- Define a minimal benchmark corpus + metrics schema, including cross-lingual queries (KABSD-USR-0034).\n\nImplementation sequencing (high-level):\n- Implement chunking/token-budget MVP (KABSD-USR-0029; spec in KABSD-TSK-0207).\n- Implement embedding adapter interface + telemetry (KABSD-USR-0031).\n- Connect embeddings -> vector backend adapter (KABSD-USR-0030; contract in KABSD-TSK-0208).\n- Add benchmark harness and iterate on defaults (KABSD-USR-0034 + ADR validation).\n\n## Notes on Topic Hygiene\n\n- `brief.md` is typically regenerated by `topic distill` and should remain deterministic; treat this\n  `notes.md` as the evolving working document and decision log for the topic.\n",
  "materials_index": {}
}