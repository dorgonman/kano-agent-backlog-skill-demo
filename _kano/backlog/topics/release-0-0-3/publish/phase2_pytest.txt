........................................................................ [  9%]
........................................................................ [ 18%]
........................................................................ [ 27%]
...ss..................ss......s....s................................... [ 37%]
...........................ss........................................... [ 46%]
........................................................................ [ 55%]
.........................................s.............................. [ 65%]
...................................F.................................... [ 74%]
.....sssssss............................................................ [ 83%]
........................................................................ [ 93%]
......................................................                   [100%]
================================== FAILURES ===================================
_________ TestPerformanceUnderErrors.test_error_handling_performance __________

self = <test_tokenizer_error_handling.TestPerformanceUnderErrors object at 0x000001FC3C33F610>

    def test_error_handling_performance(self):
        """Test that error handling doesn't significantly impact performance."""
        import time
    
        registry = TokenizerRegistry()
    
        # Mock adapter that always fails quickly
        with patch('kano_backlog_core.tokenizer.TiktokenAdapter') as mock_tiktoken:
            mock_tiktoken.side_effect = ImportError("tiktoken not found")
    
            start_time = time.time()
    
            # Multiple fallback attempts should still be fast
            for _ in range(5):
                try:
                    registry.resolve(adapter_name="tiktoken", model_name="gpt-4")
                except Exception:
                    pass
    
            elapsed = time.time() - start_time
    
            # Should complete quickly even with errors
>           assert elapsed < 1.0  # Less than 1 second for 5 attempts
            ^^^^^^^^^^^^^^^^^^^^
E           assert 1.615081548690796 < 1.0

skills\kano-agent-backlog-skill\tests\test_tokenizer_error_handling.py:392: AssertionError
------------------------------ Captured log call ------------------------------
ERROR    kano_backlog_core.tokenizer_errors:tokenizer_errors.py:605 Tokenizer error: Tokenizer adapter 'tiktoken' is not available: Maximum recovery attempts exceeded for tiktoken with model gpt-4
ERROR    kano_backlog_core.tokenizer_errors:tokenizer_errors.py:608 Context: {'error_type': 'AdapterNotAvailableError', 'error_message': "Tokenizer adapter 'tiktoken' is not available: Maximum recovery attempts exceeded for tiktoken with model gpt-4", 'adapter_name': 'tiktoken', 'model_name': 'gpt-4', 'timestamp': 1770462275.7870872, 'recovery_attempts': 3, 'degradation_history': []}
WARNING  kano_backlog_core.tokenizer:tokenizer.py:1114 Adapter tiktoken creation failed, attempting graceful degradation
ERROR    kano_backlog_core.tokenizer:tokenizer.py:1187 Fallback adapter huggingface also failed: Failed to load HuggingFace tokenizer for gpt-4: gpt-4 is not a local folder and is not a valid model identifier listed on 'https://huggingface.co/models'
If this is a private repository, make sure to pass a token having permission to this repo either by logging in with `hf auth login` or by passing `token=<your_token>`
WARNING  kano_backlog_core.tokenizer:tokenizer.py:1208 Emergency fallback to heuristic adapter for model gpt-4 after both tiktoken and huggingface failed
ERROR    kano_backlog_core.tokenizer_errors:tokenizer_errors.py:605 Tokenizer error: Tokenizer adapter 'tiktoken' is not available: Maximum recovery attempts exceeded for tiktoken with model gpt-4
ERROR    kano_backlog_core.tokenizer_errors:tokenizer_errors.py:608 Context: {'error_type': 'AdapterNotAvailableError', 'error_message': "Tokenizer adapter 'tiktoken' is not available: Maximum recovery attempts exceeded for tiktoken with model gpt-4", 'adapter_name': 'tiktoken', 'model_name': 'gpt-4', 'timestamp': 1770462276.584717, 'recovery_attempts': 3, 'degradation_history': [{'timestamp': 1770462276.584689, 'failed_adapter': 'tiktoken', 'fallback_adapter': 'heuristic', 'model_name': 'gpt-4', 'error_type': 'AdapterNotAvailableError', 'error_message': "Tokenizer adapter 'tiktoken' is not available: Maximum recovery attempts exceeded for tiktoken with model gpt-4"}]}
WARNING  kano_backlog_core.tokenizer:tokenizer.py:1114 Adapter tiktoken creation failed, attempting graceful degradation
ERROR    kano_backlog_core.tokenizer:tokenizer.py:1187 Fallback adapter huggingface also failed: Failed to load HuggingFace tokenizer for gpt-4: gpt-4 is not a local folder and is not a valid model identifier listed on 'https://huggingface.co/models'
If this is a private repository, make sure to pass a token having permission to this repo either by logging in with `hf auth login` or by passing `token=<your_token>`
WARNING  kano_backlog_core.tokenizer:tokenizer.py:1208 Emergency fallback to heuristic adapter for model gpt-4 after both tiktoken and huggingface failed
============================== warnings summary ===============================
skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:87
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:87: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('name')

skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:93
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('prefix')

skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:103
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:103: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('backlog_root')

skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:119
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\project_config.py:119: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('products')

tests/test_chunks_db.py: 2 warnings
tests/test_cli_check_ready.py: 8 warnings
tests/test_hybrid_search.py: 1 warning
tests/test_index_status.py: 1 warning
tests/test_integrated_workflow.py: 8 warnings
tests/test_integration_workflow_compatibility.py: 1 warning
tests/test_vector_index_incremental.py: 2 warnings
tests/test_workitem_ops.py: 37 warnings
  C:\Python314\Lib\site-packages\frontmatter\__init__.py:161: DeprecationWarning: codecs.open() is deprecated. Use open() instead.
    with codecs.open(fd, "r", encoding) as f:

tests/test_config_migration.py::test_migrate_json_dry_run_leaves_files_untouched
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_dry_run_leav0\_kano\backlog\_shared\defaults.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_dry_run_leaves_files_untouched
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_dry_run_leav0\_kano\backlog\products\demo\_config\config.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_writes_toml_and_backup
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_writes_toml_0\_kano\backlog\_shared\defaults.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_writes_toml_and_backup
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_writes_toml_0\_kano\backlog\products\demo\_config\config.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_skips_when_toml_exists[True]
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_skips_when_t0\_kano\backlog\_shared\defaults.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_skips_when_toml_exists[False]
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_skips_when_t1\_kano\backlog\_shared\defaults.json
    return callback(**use_params)

tests/test_config_migration.py::test_migrate_json_skips_when_toml_exists[False]
  C:\Python314\Lib\site-packages\typer\main.py:706: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_migrate_json_skips_when_t1\_kano\backlog\products\demo\_config\config.json
    return callback(**use_params)

tests/test_config_toml.py::test_json_loads_when_no_toml
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\config.py:616: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_json_loads_when_no_toml0\_kano\backlog\_shared\defaults.json
    return ConfigLoader._read_config_optional(backlog_root / "_shared", "defaults")

tests/test_config_toml.py::test_deep_merge_toml_and_json
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\config.py:297: DeprecationWarning: JSON config is deprecated; migrate to TOML: D:\_work\_Kano\kano-agent-backlog-skill-demo\_kano\backlog\_tmp_tests\pytest\basetemp\test_deep_merge_toml_and_json0\_kano\backlog\topics\test-topic\config.json
    return ConfigLoader._read_config_optional(ConfigLoader.get_topic_path(backlog_root, topic_name), "config")

tests/test_hybrid_search.py::test_hybrid_search_end_to_end
tests/test_hybrid_search.py::test_hybrid_search_end_to_end
tests/test_integrated_workflow.py::test_integrated_index_and_search_workflow
tests/test_integrated_workflow.py::test_integrated_index_and_search_workflow
tests/test_integrated_workflow.py::test_integrated_index_and_search_workflow
tests/test_vector_index.py::TestIndexDocument::test_index_document_with_sqlite_backend
tests/test_vector_index_incremental.py::test_vector_index_incremental_and_prune
tests/test_vector_index_incremental.py::test_vector_index_incremental_and_prune
tests/test_vector_index_incremental.py::test_vector_index_incremental_and_prune
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\vector\sqlite_backend.py:99: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "created_at": datetime.utcnow().isoformat() + "Z",

tests/test_tokenizer_adapters.py::TestHuggingFaceAdapter::test_huggingface_model_validation
  C:\Python314\Lib\site-packages\transformers\models\gpt2\tokenization_gpt2.py:110: DeprecationWarning: Deprecated in 0.9.0: BPE.__init__ will not create from files anymore, try `BPE.from_file` instead
    BPE(

tests/test_tokenizer_config_validation_comprehensive.py::TestConfigurationMigrationEdgeCases::test_migration_file_operations
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\tests\test_tokenizer_config_validation_comprehensive.py:618: DeprecationWarning: JSON config is deprecated; migrate to TOML: C:\Users\User\AppData\Local\Temp\tmp_jjara00.json
    TokenizerConfigMigrator.migrate_file(Path(input_file.name), Path(output_file.name))

tests/test_tokenizer_config_validation_comprehensive.py::TestConfigurationLoadingIntegration::test_load_config_with_environment_integration
  D:\_work\_Kano\kano-agent-backlog-skill-demo\skills\kano-agent-backlog-skill\src\kano_backlog_core\tokenizer_config.py:497: DeprecationWarning: JSON config is deprecated; migrate to TOML: C:\Users\User\AppData\Local\Temp\tmp5ecfqj69.json
    return TokenizerConfigLoader.load_from_file(config_path)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED skills\kano-agent-backlog-skill\tests\test_tokenizer_error_handling.py::TestPerformanceUnderErrors::test_error_handling_performance
1 failed, 757 passed, 17 skipped, 85 warnings in 159.19s (0:02:39)
